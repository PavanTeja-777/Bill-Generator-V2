<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--     <link rel="stylesheet" href="/css/index.css"> -->
    <title>Bill Generator</title>
    <style>
        *{
            margin: 0;
            padding: 0;
            font-family: 'Times New Roman', Times, serif;
        }
        
        header{
            height: 10vh;
            width: 100vw;
            background-color: rgb(0, 98, 255);
            color: white;
        
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #title{
            display: block;
            font-size: 2.5em;
            font-weight: 900;
        }
        
        main{
            margin-left: 1rem;
            margin-top: 1rem;
            margin-right: 1em;
        }
        
        .item input{
            margin: .5em 1.2em;
            padding-left: 4px;
            width: 20vw;
            font-size: 1.3em;
        }
        
        thead tr th{
            padding: 0px 1vw;
            font-size: 1.3em;
        }
        
        tfoot th{
            font-size: 1.3em;
        }
        
        .item-total-cell{
            text-align: center;
            font-size: 1.4em;
        }
        
        #add-item{
            margin: 1em 0;
            padding: .5em;
            background-color: yellow;
            border-radius: 25px;
        }
        
        #add-item:hover{
            box-shadow: black 2px 2px 0px 0px;
            background-color: rgb(255, 255, 118);
            font-weight: bolder;
        }
        
        #print-bill{
            padding: .5em;
            background-color: rgb(0, 132, 255);
            color: whitesmoke;
            border-radius: 25px;
        }
        
        #print-bill:hover{
            box-shadow: black 2px 2px 0px 0px;
            background-color: rgb(0, 102, 198);
            font-weight: bolder;
        }
        
        .del-cell{
            text-align: center;
        }
        
        .delete-btn {
            background-color: #ff4d4d;
            color: white;
            border: none;
            text-align: center;
            border-radius: 1em;
            cursor: pointer;
            padding: .1em .5em;
            font-size: 1em;
        }
        
        .delete-btn:hover {
            background-color: #d60707;
        }
        
        #gtotal{
            font-size: 1.3em;
        }
        
        @media print {
            .no-print {
                display: none;
            }
        
            input {
                display: none;
            }
        
            td::before {
                content: attr(data-value);
                font-size: 14px;
                padding-left: 10px;
                display: inline-block;
            }
        }
    </style>
</head>
<body>
    <header class="no-print">
        <span id="title">Yogeshwara Stores</span>
    </header>
    <main>
        <table class="items" border>
            <thead>
                <tr>
                    <th>Item name</th>
                    <th>Item Qty</th>
                    <th>Item Price</th>
                    <th>Item Cost</th>
                    <th class="no-print">Delete</th>
                </tr>
            </thead>
            <tbody>
                <tr class="item">
                    <td>
                        <input class='item-name' type="text" placeholder="Item Name Here">
                    </td>
                    <td>
                        <input class='item-qty' type="text" placeholder="Quantity Here" maxlength="3">
                    </td>
                    <td>
                        <input class='item-price' type="text" placeholder="Item Price Here" maxlength="4">
                    </td>
                    <td class="item-total-cell">
                        <span>₹</span>
                        <span class="item-total">0</span>
                    </td>
                    <td class="no-print del-cell">
                        <button class="delete-btn">Delete</button>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3">Total</th>
                    <td id='gtotal' colspan="2" align="center">0</td>
                </tr>
            </tfoot>
        </table>
        <button id="add-item" class="no-print">
            Add Item
        </button>
        <br>
        <button id="print-bill" onclick="print()" class="no-print">
            Print Bill
        </button>
    </main>
    <script>
        const template = `                
        <tr class="item">
            <td>
                <input type="text" class="item-name" placeholder="Item Name Here">
            </td>
            <td>
                <input type="text" class="item-qty" placeholder="Quantity Here" maxlength="3">
            </td>
            <td>
                <input type="text" class="item-price" placeholder="Item Price Here" maxlength="4">
            </td>
            <td class="item-total-cell">
                <span>₹</span>
                <span class="item-total">0</span>
            </td>
            <td class="no-print del-cell">
                <button class="delete-btn">Delete</button>
            </td>
        </tr>
        `
        
        document.querySelector('#add-item').addEventListener('click', () => {
            // Instead of replacing the entire tbody, append the new row.
            document.querySelector('tbody').insertAdjacentHTML('beforeend', template);
            updateOverallTotal()
        });
        
        // Event delegation: add a single event listener to the <tbody>
        document.querySelector('tbody').addEventListener('input', (event) => {
            if (event.target.classList.contains('item-qty') || event.target.classList.contains('item-price')) {
                const row = event.target.closest('tr'); // Find the closest <tr> element
                const qty = parseInt(row.querySelector('.item-qty').value) || 0; // Get quantity
                const price = parseInt(row.querySelector('.item-price').value) || 0; // Get price
                const total = qty * price;
                row.querySelector('.item-total').innerText = total; // Update the total
            }
            updateOverallTotal()
        });
        
        document.querySelector('tbody').addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-btn')) {
                const row = event.target.closest('tr'); // Find the closest <tr> element
                row.remove(); // Remove the row from the table
            }
            updateOverallTotal()
        });
        
        window.addEventListener('beforeprint', () => {
            document.querySelectorAll('tr.item').forEach(row => {
                row.querySelectorAll('input').forEach(input => {
                    const td = input.closest('td');
                    td.setAttribute('data-value', input.value); // Set data-value to input's value
                });
            });
        });
        
        function updateOverallTotal() {
            let overallTotal = 0;
            document.querySelectorAll('.item-total').forEach(totalCell => {
                overallTotal += parseInt(totalCell.innerText) || 0; // Sum all item totals
            });
            document.querySelector('#gtotal').innerText = overallTotal; // Update the overall total display
        }
    </script>
</body>
</html>
